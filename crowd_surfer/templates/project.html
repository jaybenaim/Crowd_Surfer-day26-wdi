
{% extends 'base.html' %}
{% block content %}
{% if request.user in project.backers.all %}
<div class='backed-header'>
   <h3> You have already backed this project</h3>
</div>
{% endif %}
<div class='form-container project-page'> 
    {% if status == 'Complete' %}
        <h2> This project has met it's funding goal </h2>
    {% elif status == 'Backed' %}
        <h2> This project has met it's funding goal, but is still running </h2>
        <h2> You can still back this project </h2>
    {% elif status == 'Expired' %}
        <h2> This project has expired, it did not meet it's funding goal </h2>
    {% else %}
        <h2> This project is still running </h2>
    {% endif %}


    <h3> Owner: {{project.owner.username}} </h3>
    <h1>{{project.title}}</h1>
    <h4>{{project.category}}</h4>
    <p> {{project.description}}</p>
    <p> {{project.funding_start_date}} to {{project.funding_end_date}} </p>
    <form action="{% url 'reward_delete' project.pk  %}" method="POST">
        {% csrf_token %}
        <div class="reward-container">
            {% for reward in rewards %}

            <span>{{reward.reward_item}} </span> 
            <span>{{reward.reward_description}}</span>
            <span>${{reward.reward_amount}} </span>
            <span>{{reward.reward_limit}} </span>
            <span><input type="checkbox" name="delete_reward" value="{{reward.pk}}"> </input</span>
            
            {% endfor %}
            <input type="submit" value="DELETE!">
        </div>
    </form>
        
    <p>TIME UNTIL FUNDING DATE: {{delta.days}} DAYS </p> 
    <p> {{ funding_end_date }}</p> 
    <p>Total Amount Pledged To Date: ${{ total_donations }} of ${{ project.funding_goal }}</p>
    {% for tag in project.tags.all %}
    <u class="tag-list">
        <li class="tag">{{tag}}</li>
    </ul>
    {% endfor %}
    <ul>
        {% for reward in rewards %}
        <li> 
        <p>{{reward.reward_item}} </p> 
        <p>{{reward.reward_description}} </p>
        <p>${{reward.reward_amount}} </p>
        <p> Limited {{ reward.donations.all|length }} left of {{reward.reward_limit}} </p>
        <p> {{ reward.donations.all|length }} Backers </p>
        {% if request.user not in project.backers.all and request.user != project.owner and status != 'Expired' and status != 'Complete' %}
         <form action="{% url 'back_project' id=reward.pk %}">
        <input type="submit" value="Back Project">
        </form>
        {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% if request.user == project.owner and status != 'Expired'%} 
    <form action="{% url 'reward_create' project.pk %}" method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="submit">
    </form>
    {% endif %} 

    <br /> 
    <ul> <h5> Comments: </h5> 
        {% for comment in comments %}
            <li>{{comment.text}} - {{comment.date}}</li>

        {% endfor %}
    </ul> 
    {% if request.username == project.backers.username %}
    <form class='comment-form' action="{% url 'create_comment' %}" method="POST"> 
        {% csrf_token %}
        <input type='hidden' name='project' value="{{ project.pk }}" > 
        <label for='form-text' name='form-text'> Comment: </label>
        {{ comment_form.text }}
        <input class="comment-form-submit" type="submit" name="submit" value="Submit" > 
    </form> 
    {% endif %}

    <ul> <h5> About my project: </h5>
    {% for update in updates %}
    <li>{{update.text}} - {{update.date}}</li>
    {% endfor %}
    </ul>
    {% if request.user == project.owner %}
    <form class='update-form' action="{% url 'create_comment' %}" method="POST"> 
        {% csrf_token %}
        <input type='hidden' name='project' value="{{ project.pk }}" > 
        <label for='form-text' name='form-text'> Comment: </label>
        {{ comment_form.text }}
        <input class="update-form-submit" type="submit" name="submit" value="Submit" > 
    </form> 
    {% endif %}
    

</div> 


{% endblock %}